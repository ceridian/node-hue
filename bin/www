#!/usr/bin/env node
var debug = require('debug')('launcher');
var fs = require('fs');
var path = require('path');
var https = require('https');
var app = require('../app');
var models = require('../models');
var s = require('../lib/sockets.js');

app.set('port', process.env.PORT || 443);
process.env.DEBUG = '*';

var options = {
	key: fs.readFileSync(path.join(__dirname, 'server.key')),
	cert: fs.readFileSync(path.join(__dirname, 'server.crt'))
};

models.sequelize.sync().complete(function(err){
	if(err){
		console.log(err);
	}else{
		debug('Initializing')
		var server = https.createServer(options, app);
		var io = require('socket.io')(server);
		server.listen(app.get('port'));
		s.socketsInit(io);
		debug('Express server listening on port ' + server.address().port);
		/*var server = app.listen(app.get('port'), function() {
			debug('Express server listening on port ' + server.address().port);
		});*/
	}
});

