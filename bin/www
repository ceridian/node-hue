#!/usr/bin/env node
var debug = require('debug')('launcher');
var app = require('../app');
var https = require('https');
var models = require('../models');
var fs = require('fs');

app.set('port', process.env.PORT || 443);

var options = {
	key: fs.readFileSync('./server.key'),
	cert: fs.readFileSync('./server.crt')
};

models.sequelize.sync().complete(function(err){
	if(err){
		console.log(err);
	}else{
		debug('Initializing')
		var server = https.createServer(options, app);
		var io = require('socket.io')(server);
		server.listen(app.get('port'));
		s.socketsInit(io);
		debug('Express server listening on port ' + server.address().port);
		/*var server = app.listen(app.get('port'), function() {
			debug('Express server listening on port ' + server.address().port);
		});*/
	}
});

